

<!DOCTYPE html>
<html>
<head>
<style type="text/css">
.emphasized {
  text-decoration: underline;
  font-weight: bold;
  font-style: italic;
}
</style>
</head>
<body>
  <button type="button" onclick="applyTagwClass(this);" data-tag="span" data-tagClass="emphasized">Bold</button>
  <div  class="textEditor">
    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. In malesuada quis lorem non consequat. Proin diam magna, molestie nec leo non, sodales eleifend nibh. Suspendisse a tellus facilisis, adipiscing dui vitae, rutrum mi. Curabitur aliquet
      lorem quis augue laoreet feugiat. Nulla at volutpat enim, et facilisis velit. Nulla feugiat quis augue nec sodales. Nulla nunc elit, viverra nec cursus non, gravida ac leo. Proin vehicula tincidunt euismod.</p>
    <p>Suspendisse non consectetur arcu, ut ultricies nulla. Sed vel sem quis lacus faucibus interdum in sed quam. Nulla ullamcorper bibendum ornare. Proin placerat volutpat dignissim. Ut sit amet tellus enim. Nulla ut convallis quam. Morbi et
      sollicitudin nibh. <span class="clippy">Maecenas</span> justo lectus, porta non felis eu, condimentum dictum nisi. Nulla eu nisi neque. Phasellus id sem congue, consequat lorem nec, tincidunt libero.</p>
    <p>Integer eu elit eu massa placerat venenatis nec in elit. Ut ullamcorper nec mauris et volutpat. Phasellus ullamcorper tristique quam. In pellentesque nisl eget arcu fermentum ornare. Aenean nisl augue, mollis nec tristique a, dapibus quis urna.
      Vivamus volutpat ullamcorper lectus, et malesuada risus adipiscing nec. Ut nec ligula orci. Morbi sollicitudin nunc tempus, vestibulum arcu nec, feugiat velit. Aenean scelerisque, ligula sed molestie iaculis, massa risus ultrices nisl, et placerat
      augue libero vitae est. Pellentesque ornare adipiscing massa eleifend fermentum. In fringilla accumsan lectus sit amet aliquam.</p>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script>
      function applyTagwClass(self) {
        var selection = window.getSelection();
        if (selection.rangeCount) {
          var text = selection.toString();
          var range = selection.getRangeAt(0);
          var parent = $(range.startContainer.parentNode);
          if (range.startOffset > 0 && parent.hasClass(self.attributes['data-tagClass'].value)) {
            var prefix = '<span class="emphasized">' + parent.html().substr(0,selection.anchorOffset) + '</span>';
            var suffix = '<span class="emphasized">' + parent.html().substr(selection.focusOffset) + '</span>';
            parent.replaceWith(prefix + text + suffix);
            console.log(parent.html().substr(0,selection.anchorOffset))
            console.log(parent.html().substr(selection.focusOffset))
          } else {
            range.deleteContents();
            range.insertNode($('<span class="clippy">' + text + '</span>')[0]);
            $('span.clippy:empty').remove();
          }
        }
      }
      
      
      
      //clippyMgmt
      document.addEventListener("selectionchange", () => {
      	var tmp=document.getSelection().toString();
      	var add=document.getElementById("clippyMgmtAdd");
        if (tmp) {
        	add.style.backgroundColor='#0050FE'
        	add.style.cursor='pointer'
        } else {
            add.style.backgroundColor='#c1c1c1'
            add.style.cursor=''
        }
      });
      var editMode = "g" //document.getElementById("ctl00_PlaceHolderMain_WikiField_ctl00_ctl00_TextField_inplacerte_layoutsTable")
    if (editMode && !(document.getElementById("clippyMgmtTlt"))) {
        var div = document.createElement('div');
        div.classList.add("cssButtonContainer");
        div.innerHTML = "\
	    <div onclick='            ' id='clippyMgmtTlt' class='cssTiTleToTop  cssStyleButton'>Clippy Manager</div><br><br>\
        <div onclick='addClippy();' id='clippyMgmtAdd' class='cssButtonToTop cssStyleButton'>Aggiungi</div><br> \
        <div onclick='rmvClippy();' id='clippyMgmtRmv' class='cssButtonToTop cssStyleButton'>Elimina</div><br>\
        <div onclick='            ' id='clippyMgmtAll' class='cssButtonToTop cssStyleButton'>Elimina Tutto</div><br>"
        $(div).appendTo("body");
        $(".cssButtonContainer").css({"display": "block", "position": "fixed", "bottom": "20px", "left": "10px", "font-size": "5px", "padding": "20px","user-select":"none","text-align": "center"});
        $(".cssStyleButton").css({"font-size": "18px", "border": "none", "outline": "none", "background-color": "#C1C1C1", "color": "white"});
        $(".cssButtonToTop").css({"display": "", "cursor": "pointer", "padding": "5px","width":"60%", "margin":"0 auto"});
        $(".cssTiTleToTop").css({"width": "-moz-min-content", "padding": "5px", "background-color": "#0050FE", "color": "white"});
    }
    
    function addClippy() {
    	var selection = window.getSelection();
    	if (selection.toString() != '') {
    		var range = selection.getRangeAt(0);
    		var spn = document.createElement("span");
    		spn.classList.add('clippy');
    		spn.appendChild(range.extractContents());
    		range.insertNode(spn); 
    		
			show();
    	}
    }
    function rmvClippy() {
    var els = document.getElementsByClassName('clippy');
	    for (var X=0; X< els.length; X++) {
			els[X].setAttribute("onClick", "clippyRmv(this);");
		}
    }
	
	function clippyRmv(el) {
		$(el).contents().unwrap();
	}
	
    //clippy
        function clippy(text) {
          if (window.tst != undefined) {return} else {window.tst=1};
          el.value = text.innerText.replace(/\n*$/gi,"");;
          el.select();
          document.execCommand('copy');
          var bkp = (text.style.color === undefined) ? '' : text.style.color;
          text.style.color = 'red';
          setTimeout(function(){text.style.color = bkp; window.tst=undefined;} ,300)
    }

    window.clippy=clippy;

    var el = document.createElement('textarea');
    el.style.position = 'absolute';
    el.style.left = '-9999px';
    el.id = 'clippyTextArea'
    document.body.appendChild(el);

function show() {
    var els = document.getElementsByClassName('clippy');
    var edt = document.getElementById("ctl00_PlaceHolderMain_WikiField_ctl00_ctl00_TextField_inplacerte_layoutsTable");
    for (var X=0; X< els.length; X++) {
        els[X].setAttribute("onClick", "clippy(this);");
        if (!(edt)) {els[X].style.color = "#009ac3"};
    }
}
show();
    </script>
</body>
</html>

<textarea id="ttttt"></textarea>

var span = document.getElementById("foo");
span.parentNode.replaceChild(document.createTextNode("bar"), span
